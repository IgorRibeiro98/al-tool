# ============================================================================
# AL-Tool - Configuraﾃｧﾃ｣o Principal do Monorepo
# ============================================================================
# Copie este arquivo para .env na raiz do projeto.
# Este ﾃｩ o ﾃ哢ICO arquivo de configuraﾃｧﾃ｣o - API, Desktop e Client leem daqui.
# 
# 識 OTIMIZAﾃﾃグ AUTOMﾃゝICA:
# A maioria das configuraﾃｧﾃｵes de performance ﾃｩ calculada AUTOMATICAMENTE
# com base na RAM disponﾃｭvel. Sﾃｳ sobrescreva se souber o que estﾃ｡ fazendo.
#
# Perfil alvo: 8GB RAM, Intel i5 8ﾂｪ Gen, Windows 11, SSD
#
# | RAM    | Cache SQLite | MMAP        | Workers | Batch Ingest |
# |--------|--------------|-------------|---------|--------------|  
# | <6GB   | ~100MB       | ~256MB      | 2       | 2500         |
# | 8GB    | ~400MB       | ~512MB      | 4       | 5000         |
# | 16GB+  | ~800MB       | ~1GB        | 6       | 10000        |
# ============================================================================

NODE_ENV=production

# Porta do servidor
APP_PORT=3000
PORT=3000

# URL base (usado pelo Electron)
APP_BASE_URL=http://localhost:3000

# Diretﾃｳrio de dados (banco, uploads, exports)
# No Windows com Electron: %APPDATA%/al-tool-desktop/data
# No Linux: ~/.config/al-tool-desktop/data
DATA_DIR=/caminho/para/dados

# ============================================================================
# SQLITE - Configuraﾃｧﾃｵes de Performance
# ============================================================================

# Modo de journaling (WAL = Write-Ahead Logging, mais rﾃ｡pido)
SQLITE_JOURNAL_MODE=WAL

# Sincronizaﾃｧﾃ｣o (NORMAL = bom equilﾃｭbrio seguranﾃｧa/performance)
SQLITE_SYNCHRONOUS=NORMAL

# Cache em memﾃｳria (negativo = nﾃｺmero de pﾃ｡ginas de 4KB)
# -100000 = ~400MB, -200000 = ~800MB, -400000 = ~1.6GB
SQLITE_CACHE_SIZE=-100000

# Tabelas temporﾃ｡rias em memﾃｳria
SQLITE_TEMP_STORE=MEMORY

# Timeout para locks (ms) - 60s para operaﾃｧﾃｵes longas
SQLITE_BUSY_TIMEOUT=60000

# Chaves estrangeiras
SQLITE_FOREIGN_KEYS=ON

# Memory-mapped I/O (bytes) - acelera leituras significativamente
# 536870912 = 512MB, 1073741824 = 1GB
SQLITE_MMAP_SIZE=536870912

# ============================================================================
# INGESTﾃグ
# ============================================================================

# Linhas amostradas para detecﾃｧﾃ｣o de tipos
INGEST_SAMPLE_ROWS=1500

# Linhas por batch durante ingestﾃ｣o
INGEST_BATCH_SIZE=8000

# Overrides opcionais para ingestﾃ｣o (usa SQLITE_* se nﾃ｣o definido)
# INGEST_PRAGMA_CACHE_SIZE=-200000
# INGEST_PRAGMA_MMAP_SIZE=1073741824
# INGEST_PRAGMA_BUSY_TIMEOUT=60000

# ============================================================================
# WORKERS (Polling)
# ============================================================================

# Intervalo de polling em segundos
WORKER_POLL_SECONDS=3

# ============================================================================
# COLUNAS DERIVADAS (ABS, INVERTER) - Performance Otimizada
# ============================================================================
# Guia de configuraﾃｧﾃ｣o por tamanho de tabela:
#
# | Linhas na tabela | Modo      | Tempo esperado                    |
# |------------------|-----------|-----------------------------------|
# | < 500K           | FAST      | ~2-5 segundos (UPDATE ﾃｺnico)      |
# | 500K - 2M        | BATCH     | ~10-30 segundos                   |
# | > 2M             | BATCH     | ~30-90 segundos                   |
# ============================================================================

# Intervalo de polling em segundos
DERIVED_COLUMN_POLL_SECONDS=3

# Threshold para modo FAST (UPDATE ﾃｺnico) vs BATCH
# Tabelas com menos linhas que este valor usam UPDATE ﾃｺnico
# Padrﾃ｣o: 500000 (500K linhas)
DERIVED_COLUMN_FAST_THRESHOLD=500000

# Tamanho do batch para modo BATCH (tabelas grandes)
# Valores maiores = menos queries, mas mais memﾃｳria
# Padrﾃ｣o: 50000
DERIVED_COLUMN_BATCH_SIZE=50000

# Usar UPDATE direto (mais rﾃ｡pido que batch para maioria dos casos)
DERIVED_COLUMN_DIRECT_UPDATE=true

# Threshold para rodar em background vs foreground
DERIVED_COLUMN_BACKGROUND_THRESHOLD=10000

# Debug logging (true/false)
DERIVED_COLUMN_DEBUG=false

# ============================================================================
# EXPORTAﾃﾃグ DE CONCILIAﾃﾃグ - Performance Otimizada
# ============================================================================
# Guia de configuraﾃｧﾃ｣o por RAM e tamanho da base:
#
# | RAM    | CHUNK_SIZE | STREAM_BATCH | PARALLEL_BASES | ZIP_LEVEL |
# |--------|------------|--------------|----------------|-----------|
# | 4GB    | 15000      | 5000         | false          | 6         |
# | 8GB    | 25000      | 10000        | true           | 6         |
# | 16GB+  | 50000      | 20000        | true           | 4         |
# ============================================================================

# Nﾃｭvel de compressﾃ｣o ZIP (1-9)
# Menor = mais rﾃ｡pido, maior = menor arquivo
# Padrﾃ｣o: 6 (bom equilﾃｭbrio velocidade/tamanho)
EXPORT_ZIP_COMPRESSION_LEVEL=6

# Linhas por query ao ler do banco
# Maior = menos queries, mais memﾃｳria
# Padrﾃ｣o: 25000
EXPORT_CHUNK_SIZE=25000

# Buffer de escrita Excel (linhas acumuladas antes de flush)
# Padrﾃ｣o: 10000
EXPORT_STREAM_BATCH_SIZE=10000

# Threshold para criar ﾃｭndices temporﾃ｡rios (melhora JOINs em tabelas grandes)
# Padrﾃ｣o: 50000
EXPORT_TEMP_INDEX_THRESHOLD=50000

# Exportar Base A e B em paralelo (true/false)
# true = mais rﾃ｡pido, usa ~2x memﾃｳria durante export
# Padrﾃ｣o: true
EXPORT_PARALLEL_BASES=true

# ============================================================================
# WORKER THREADS (Multithreading para processamento paralelo)
# ============================================================================
# Guia de configuraﾃｧﾃ｣o por RAM disponﾃｭvel:
#
# | RAM    | POOL_SIZE | INGEST_BATCH | CONCILIACAO_BATCH | ESTORNO_BATCH |
# |--------|-----------|--------------|-------------------|---------------|
# | 4GB    | 2         | 3000         | 500               | 5000          |
# | 8GB    | 4         | 5000         | 1000              | 10000         |
# | 16GB   | 6         | 8000         | 2000              | 20000         |
# | 32GB+  | 8         | 10000        | 3000              | 30000         |
# ============================================================================

# Habilita/desabilita worker threads (true/false)
# Padrﾃ｣o: true se CPUs > 2
WORKER_THREADS_ENABLED=true

# Nﾃｺmero global de workers no pool
# Padrﾃ｣o: CPUs - 1 (deixe vazio para auto-detectar)
WORKER_POOL_SIZE=4

# Timeout para tarefas de worker (ms)
# Padrﾃ｣o: 300000 (5 minutos)
WORKER_TASK_TIMEOUT=300000

# Logs detalhados de workers (true/false)
WORKER_DEBUG_LOGGING=false

# --- Thresholds (volume mﾃｭnimo para usar workers) ---
# Abaixo destes valores, processamento sﾃｭncrono ﾃｩ mais eficiente
WORKER_INGEST_THRESHOLD=1000
WORKER_CONCILIACAO_THRESHOLD=500
WORKER_ESTORNO_THRESHOLD=5000
WORKER_ATRIBUICAO_THRESHOLD=100

# --- Pool Sizes por Fluxo (opcional - sobrescreve WORKER_POOL_SIZE) ---
# Deixe comentado para usar o valor global
# WORKER_INGEST_POOL_SIZE=4
# WORKER_CONCILIACAO_POOL_SIZE=4
# WORKER_ESTORNO_POOL_SIZE=4
# WORKER_ATRIBUICAO_POOL_SIZE=4

# --- Batch Sizes (tamanho dos lotes enviados aos workers) ---
WORKER_INGEST_BATCH_SIZE=5000
WORKER_CONCILIACAO_BATCH_SIZE=1000
WORKER_ESTORNO_BATCH_SIZE=10000
WORKER_ATRIBUICAO_BATCH_SIZE=500

# ============================================================================
# API
# ============================================================================

# CORS (necessﾃ｡rio para Electron)
CORS_ORIGIN=*

# Paginaﾃｧﾃ｣o
API_DEFAULT_PAGE_SIZE=50
API_MAX_PAGE_SIZE=300
API_RESULT_PAGE_SIZE=50

# ============================================================================
# MANUTENﾃﾃグ
# ============================================================================

# Dias para manter resultados de conciliaﾃｧﾃ｣o antes de limpeza automﾃ｡tica
CLEANUP_RESULTS_TTL_DAYS=30

# ============================================================================
# LICENCIAMENTO
# ============================================================================

# URL da API de licenciamento
LICENSE_API_BASE_URL=https://your-license-api.example.com/api

# Secret para autenticaﾃｧﾃ｣o com a API de licenciamento
LICENSE_API_SECRET=your-api-secret-here

# ============================================================================
# AL-Tool - Arquivo de Exemplo de Configuração
# ============================================================================
# Copie este arquivo para .env e ajuste conforme necessário.
# 
# IMPORTANTE: Não há distinção entre dev/prod - sempre usamos configurações
# otimizadas para produção. Ajuste os valores de cache conforme sua RAM:
#
# | RAM    | SQLITE_CACHE_SIZE | SQLITE_MMAP_SIZE | INGEST_BATCH_SIZE |
# |--------|-------------------|------------------|-------------------|
# | 8GB    | -100000 (~400MB)  | 536870912 (512MB)| 8000             |
# | 16GB   | -200000 (~800MB)  | 1073741824 (1GB) | 15000            |
# | 32GB+  | -400000 (~1.6GB)  | 2147483648 (2GB) | 25000            |
# ============================================================================

NODE_ENV=production

# Porta do servidor
APP_PORT=3000
PORT=3000

# URL base (usado pelo Electron)
APP_BASE_URL=http://localhost:3000

# Diretório de dados (banco, uploads, exports)
# No Windows com Electron: %APPDATA%/al-tool-desktop/data
# No Linux: ~/.config/al-tool-desktop/data
DATA_DIR=/caminho/para/dados

# ============================================================================
# SQLITE - Configurações de Performance
# ============================================================================

# Modo de journaling (WAL = Write-Ahead Logging, mais rápido)
SQLITE_JOURNAL_MODE=WAL

# Sincronização (NORMAL = bom equilíbrio segurança/performance)
SQLITE_SYNCHRONOUS=NORMAL

# Cache em memória (negativo = número de páginas de 4KB)
# -100000 = ~400MB, -200000 = ~800MB, -400000 = ~1.6GB
SQLITE_CACHE_SIZE=-100000

# Tabelas temporárias em memória
SQLITE_TEMP_STORE=MEMORY

# Timeout para locks (ms) - 60s para operações longas
SQLITE_BUSY_TIMEOUT=60000

# Chaves estrangeiras
SQLITE_FOREIGN_KEYS=ON

# Memory-mapped I/O (bytes) - acelera leituras significativamente
# 536870912 = 512MB, 1073741824 = 1GB
SQLITE_MMAP_SIZE=536870912

# ============================================================================
# INGESTÃO
# ============================================================================

# Linhas amostradas para detecção de tipos
INGEST_SAMPLE_ROWS=1500

# Linhas por batch durante ingestão
INGEST_BATCH_SIZE=8000

# Overrides opcionais para ingestão (usa SQLITE_* se não definido)
# INGEST_PRAGMA_CACHE_SIZE=-200000
# INGEST_PRAGMA_MMAP_SIZE=1073741824
# INGEST_PRAGMA_BUSY_TIMEOUT=60000

# ============================================================================
# WORKERS (Polling)
# ============================================================================

# Intervalo de polling em segundos
WORKER_POLL_SECONDS=3

# ============================================================================
# COLUNAS DERIVADAS (ABS, INVERTER) - Performance Otimizada
# ============================================================================
# Guia de configuração por tamanho de tabela:
#
# | Linhas na tabela | Modo      | Tempo esperado                    |
# |------------------|-----------|-----------------------------------|
# | < 500K           | FAST      | ~2-5 segundos (UPDATE único)      |
# | 500K - 2M        | BATCH     | ~10-30 segundos                   |
# | > 2M             | BATCH     | ~30-90 segundos                   |
# ============================================================================

# Intervalo de polling em segundos
DERIVED_COLUMN_POLL_SECONDS=3

# Threshold para modo FAST (UPDATE único) vs BATCH
# Tabelas com menos linhas que este valor usam UPDATE único
# Padrão: 500000 (500K linhas)
DERIVED_COLUMN_FAST_THRESHOLD=500000

# Tamanho do batch para modo BATCH (tabelas grandes)
# Valores maiores = menos queries, mas mais memória
# Padrão: 50000
DERIVED_COLUMN_BATCH_SIZE=50000

# Debug logging (true/false)
DERIVED_COLUMN_DEBUG=false

# ============================================================================
# EXPORTAÇÃO DE CONCILIAÇÃO - Performance Otimizada
# ============================================================================
# Guia de configuração por RAM e tamanho da base:
#
# | RAM    | CHUNK_SIZE | STREAM_BATCH | PARALLEL_BASES | ZIP_LEVEL |
# |--------|------------|--------------|----------------|-----------|
# | 4GB    | 15000      | 5000         | false          | 6         |
# | 8GB    | 25000      | 10000        | true           | 6         |
# | 16GB+  | 50000      | 20000        | true           | 4         |
# ============================================================================

# Nível de compressão ZIP (1-9)
# Menor = mais rápido, maior = menor arquivo
# Padrão: 6 (bom equilíbrio velocidade/tamanho)
EXPORT_ZIP_COMPRESSION_LEVEL=6

# Linhas por query ao ler do banco
# Maior = menos queries, mais memória
# Padrão: 25000
EXPORT_CHUNK_SIZE=25000

# Buffer de escrita Excel (linhas acumuladas antes de flush)
# Padrão: 10000
EXPORT_STREAM_BATCH_SIZE=10000

# Threshold para criar índices temporários (melhora JOINs em tabelas grandes)
# Padrão: 50000
EXPORT_TEMP_INDEX_THRESHOLD=50000

# Exportar Base A e B em paralelo (true/false)
# true = mais rápido, usa ~2x memória durante export
# Padrão: true
EXPORT_PARALLEL_BASES=true

# ============================================================================
# WORKER THREADS (Multithreading para processamento paralelo)
# ============================================================================
# Guia de configuração por RAM disponível:
#
# | RAM    | POOL_SIZE | INGEST_BATCH | CONCILIACAO_BATCH | ESTORNO_BATCH |
# |--------|-----------|--------------|-------------------|---------------|
# | 4GB    | 2         | 3000         | 500               | 5000          |
# | 8GB    | 4         | 5000         | 1000              | 10000         |
# | 16GB   | 6         | 8000         | 2000              | 20000         |
# | 32GB+  | 8         | 10000        | 3000              | 30000         |
# ============================================================================

# Habilita/desabilita worker threads (true/false)
# Padrão: true se CPUs > 2
WORKER_THREADS_ENABLED=true

# Número global de workers no pool
# Padrão: CPUs - 1 (deixe vazio para auto-detectar)
WORKER_POOL_SIZE=4

# Timeout para tarefas de worker (ms)
# Padrão: 300000 (5 minutos)
WORKER_TASK_TIMEOUT=300000

# Logs detalhados de workers (true/false)
WORKER_DEBUG_LOGGING=false

# --- Thresholds (volume mínimo para usar workers) ---
# Abaixo destes valores, processamento síncrono é mais eficiente
WORKER_INGEST_THRESHOLD=1000
WORKER_CONCILIACAO_THRESHOLD=500
WORKER_ESTORNO_THRESHOLD=5000
WORKER_ATRIBUICAO_THRESHOLD=100

# --- Pool Sizes por Fluxo (opcional - sobrescreve WORKER_POOL_SIZE) ---
# Deixe comentado para usar o valor global
# WORKER_INGEST_POOL_SIZE=4
# WORKER_CONCILIACAO_POOL_SIZE=4
# WORKER_ESTORNO_POOL_SIZE=4
# WORKER_ATRIBUICAO_POOL_SIZE=4

# --- Batch Sizes (tamanho dos lotes enviados aos workers) ---
WORKER_INGEST_BATCH_SIZE=5000
WORKER_CONCILIACAO_BATCH_SIZE=1000
WORKER_ESTORNO_BATCH_SIZE=10000
WORKER_ATRIBUICAO_BATCH_SIZE=500

# ============================================================================
# API
# ============================================================================

# CORS (necessário para Electron)
CORS_ORIGIN=*

# Paginação
API_DEFAULT_PAGE_SIZE=50
API_MAX_PAGE_SIZE=300

# ============================================================================
# LICENCIAMENTO
# ============================================================================

# URL da API de licenciamento
LICENSE_API_BASE_URL=https://your-license-api.example.com/api

# Secret para autenticação com a API de licenciamento
LICENSE_API_SECRET=your-api-secret-here

# ============================================================================
# AL-Tool API - Arquivo de Exemplo
# ============================================================================
# Copie para apps/api/.env e ajuste conforme necessário.
# Este arquivo é carregado diretamente pela API Express.
# 
# NOTA: A maioria das configurações abaixo são ajustadas AUTOMATICAMENTE
# com base na RAM disponível. Só sobrescreva se souber o que está fazendo.
# 
# Perfil alvo: 8GB RAM, Intel i5 8ª Gen, Windows 11, SSD
# ============================================================================

NODE_ENV=production

# Porta do servidor
APP_PORT=3000
PORT=3000

# Diretório de dados
DATA_DIR=/caminho/para/dados

# ============================================================================
# SQLITE - Otimização de Performance
# ============================================================================
# Valores calculados automaticamente com base na RAM:
# - 8GB RAM: cache ~400MB, mmap ~512MB
# - <6GB RAM: cache ~100MB, mmap ~256MB
# - >10GB RAM: cache ~800MB, mmap ~1GB

SQLITE_JOURNAL_MODE=WAL
SQLITE_SYNCHRONOUS=NORMAL
# SQLITE_CACHE_SIZE=-100000  # Automático - não sobrescrever
SQLITE_TEMP_STORE=MEMORY
SQLITE_BUSY_TIMEOUT=60000
SQLITE_FOREIGN_KEYS=ON
# SQLITE_MMAP_SIZE=536870912  # Automático - não sobrescrever

# ============================================================================
# INGESTÃO - Otimização de Performance
# ============================================================================
# Valores calculados automaticamente com base na RAM:
# - 8GB RAM: batch 5000 linhas JSONL, 3000 XLSX
# - <6GB RAM: batch 2500 linhas JSONL, 1500 XLSX
# - >10GB RAM: batch 10000 linhas JSONL, 5000 XLSX

INGEST_SAMPLE_ROWS=1000
# INGEST_BATCH_SIZE=5000  # Automático - não sobrescrever

# ============================================================================
# WORKERS (Polling)
# ============================================================================

WORKER_POLL_SECONDS=3
DERIVED_COLUMN_POLL_SECONDS=3
DERIVED_COLUMN_BATCH_SIZE=5000
DERIVED_COLUMN_DIRECT_UPDATE=true

# ============================================================================
# WORKER THREADS (Multithreading) - Otimização de Performance
# ============================================================================
# O pool size é calculado automaticamente com base em:
# - RAM disponível (reserva 3.5GB para SO + Node + SQLite)
# - Número de CPUs (máximo CPUs - 1)
# - Limite de 4 workers por pool para máquinas de 8GB

# Habilita/desabilita worker threads
WORKER_THREADS_ENABLED=true

# Número de workers no pool (automático se não definido)
# WORKER_POOL_SIZE=4  # Automático - não sobrescrever

# Timeout por tarefa (ms)
WORKER_TASK_TIMEOUT=300000

# Logs detalhados
WORKER_DEBUG_LOGGING=false

# Thresholds (volume mínimo para usar workers)
# Valores aumentados para evitar overhead de workers em datasets pequenos
WORKER_INGEST_THRESHOLD=2000
WORKER_CONCILIACAO_THRESHOLD=1000
WORKER_ESTORNO_THRESHOLD=10000
WORKER_ATRIBUICAO_THRESHOLD=100

# Batch sizes (automáticos com base na RAM)
# WORKER_INGEST_BATCH_SIZE=5000  # Automático
# WORKER_CONCILIACAO_BATCH_SIZE=1000  # Automático
# WORKER_ESTORNO_BATCH_SIZE=10000  # Automático
# WORKER_ATRIBUICAO_BATCH_SIZE=500  # Automático

# ============================================================================
# EXPORTAÇÃO - Otimização de Performance
# ============================================================================
# Configurações calculadas automaticamente com base na RAM:
# - 8GB RAM: chunks de 25000 linhas, export paralelo habilitado
# - <6GB RAM: chunks de 10000 linhas, export sequencial
# - >10GB RAM: chunks de 50000 linhas, export paralelo

# EXPORT_CHUNK_SIZE=25000  # Automático - não sobrescrever
# EXPORT_TEMP_INDEX_THRESHOLD=50000  # Automático
# EXPORT_PARALLEL_BASES=true  # Automático com base na RAM

# Nível de compressão ZIP (1-9, 6 é balanceado)
EXPORT_ZIP_COMPRESSION_LEVEL=6

# ============================================================================
# API
# ============================================================================

CORS_ORIGIN=*
API_DEFAULT_PAGE_SIZE=50
API_MAX_PAGE_SIZE=300

# ============================================================================
# LICENCIAMENTO
# ============================================================================

LICENSE_API_BASE_URL=
LICENSE_API_SECRET=
